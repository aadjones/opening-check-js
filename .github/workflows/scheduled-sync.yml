name: Call Supabase scheduled-sync every 5 minutes

on:
  schedule:
    - cron: '*/5 * * * *'  # Every 5 minutes (UTC)
  workflow_dispatch:

jobs:
  call-scheduled-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Call Supabase Edge Function
        env:
          SR_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          URL:  https://fsmtmtconmgujlhmkqgp.functions.supabase.co/scheduled-sync
        run: |
          set -e
          code=$(curl -s -o response.txt -w '%{http_code}' -X POST "$URL" \
                  -H "apikey: $SR_KEY" \
                  -H "Authorization: Bearer $SR_KEY")
          cat response.txt
          [ "$code" -ge 200 ] && [ "$code" -lt 300 ] || {
              echo "Request failed with status $code"; exit 1; }
